---
title: "Useful Functions for R Data Management"
author: "Jacob Yousif"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Useful Libraries
```{r}
library(tidyverse) #Does a lot of stuff that makes data outputs neater
library(janitor) #Helps clean variable names
library(naniar) #Helps manage NAs
```

```{r}
library(ggplot2) #Quickly make/edit charts and graphs. Included with tidyverse

```


```{r}
#This is just a practice dataset
library(palmerpenguins)
```

```{r}
data <- palmerpenguins::penguins #Sets up data as a practice dataset
```
Note: many of he commands in this doc will not run properly. This is because the data has been messed up by all the previous commands.

##Examining Data Tables
#Bring datasets into R
```{r}
read_csv("filepath") #Finds a CSV file specified by "filepath" and loads it into R as a data frame
data.frame(data) #Creates a data frame from the values in data (data can be a vector, matrix, or subset of a data frame)
```

#Getting an idea of a dataset's structure
```{r}
data #Prints whole dataset
data$species #Prints just the column specified by $ (here, it is "species")
dim(data) #Prints "<number of rows> <number of columns>"
colnames(data) #Prints column names
names(data) #Same as colnames()
glimpse(data) #Prints rows, columns, colnames and types, and the first few rows of each column
summary(data) #Prints colnames and shows statistical overview for each column's contents (min/max values, quartiles, median, mean, number of NAs)

any_na(data) #Returns TRUE if there are NAs in a dataset, and FALSE if there are not
  # Note: Is from naniar. Has equivalent `anyNA` in base; not sure of the difference
n_miss(data) #Returns the number of total NAs in a dataset
miss_var_summary(data) #Displays how many NAs per variable, as well as percentage of variable that is made up of NAs

table(data$species) #Returns a matrix that shows how many of each  discrete value are represented in a vector
tabyl(data$species) #Same as table(), but returns in a fancy data frame
#Note: can do table/yl(data$species) or (data, species). The latter returns a nicer variable name.
```
```{r}
colnames(data)
```

##Manipulating Data
#Cleaning up data
```{r}
clean_names(data) #Returns entire dataset with cleaned-up names. Changes all names to lowercase and replaces all special characters with "_". 
  #Remember to do data <- clean_names(data); it won't actually affect the dataset unless the data are replaced. 
  #Also note that the return is an entire data table, not just the colnames.
colnames(data) <- c("name1", "name2", "...") #Assigns the values of names to be the column names of (data)

na_if(data, "-999") #If a value matches the value in quotes, replace it with an NA
```

#Selecting data subsets
```{r}
select(data, species, sex, bill_length_mm) #Selects columns
  #Note: can also be used to sort columns; will output columns   in order listed
filter(data, sex == "male") #Selects rows based on whether the variable(s) match the selection criteria
table(data$species) #Returns a matrix that shows how many of each  discrete value are represented in a vector
tabyl(data$species) #Same as table(), but returns in a fancy data frame
group_by(data$species) #Assigns an invisible number to categories in a dataset which then allows other functions to perform actions by category rather than by individual entry. (e.g. male = 0, female = 1, then summarize(avg = mean(height)) will give all male height and all female height). Can group by multiple variables.
```

#Adding/removing entries
```{r}
mutate(newcol = val) #Creates new col with values specified by val
  case_when() #Assigns categorical value to data based on whether it matches the expression found in ()
    #Syntax: case_when(x < 5.0 & x > 0.0 ~ "value")
```

#Creating data structures
```{r}
c("value1, value2, value3") #Creates a vector from data
data.frame(data) #Creates a data frame from a dataset (vector, matrix, or existing dataframe)
```

#Changing entries
```{r}
pivot_longer(data, names_to=x, values_to=x) #Pivots data to "long" format. Creates new col with values set to the previous variable names.
pivot_wider(data, names_from=x, values_from=x) #Pivots data to "wide" format. Uses names_from as names for new cols, and moves values from values_from into cols specified by names_from value. 
#
#   Wide:             Long:
#   name a b c        name letter value
#   A    1 2 3        A    a      1
#   B    1 2 3        A    a      1
#   C    1 2 3        A    a      1
#                     A    b      2   etc.
separate()
```

##Analysis of Data
#Creating analysis figures
```{r}
summarize(data, sum1 = function1(value1), sum2 = function2(value2)) #Creates a data frame containing a summary of functions. Computes function1 on all variables in value1, then stores the result in sum1, and does that for each subsequent variable.
  n() #Gives number of entries in a set
  n_distinct() #Gives number of distinct variables in a set
  across(c(values), function()) #Computes function() for each variable in c(values)
```

#Charts and graphs
```{r}
hist(data$variable) #Automatically creates a histogram (bar chart) showing values in a vector
ggplot(data, aes(aes=vars...))+geom_xx() #Creates plots via layering
  aes() #Sets x- and y-axes
    x = #sets x-axis
    y = #Sets y-axis
    fill = #Automatically sets fill color by variable given
    color = #Automatically sets primary color by variable (or specify a "color")
    group = 
#Note: format is geom() is its own object being added to the plot object. This also means can add multiple geoms to same plot (e.g. point()+smooth() for scatterplot with trendline)
  geom_x(na.rm=) #Changes geometry of the plot to be x
    point #scatter plot
    jitter #scatter plot with extra noise to variables to space points more evenly
    boxplot #boxes w/ error
    smooth #line of best fit
      (method=x) #change model of trendline
        lm #fit to linear model (straight line)
    line #connect-the-dots line
    bar #bar graph. lists # entries for each x-axis variable. no y-axis
      (stat=identity) #allows y-axis to be specified
      (position="dodge") #unstacks bars separated by fill
    col #bar graph with specific x- and y-axes
    histogram #histogram (groups continuous variables based on value range). no y-axis
      (bins=n) #specifies # of groups to use
    density #like histogram, but infinite bins. creates smooth curve. no y-axis
  scale_x/y_scalefactor() #scales axis based on scalefactor without changing original data. select x or y, and replace scalefactor with whatever the scale facor should be (e.g. sqrt, log10)
  labs() #Changes data labels (use title=, x=, y=)
  theme() #Changes text
  #Options for any of these include:
    color = #Changes line color/primary color
    fill =  #Changes fill color
    alpha = #Changes opacity
```

#Statistics
```{r}
mean() #Arithmetic mean
stats::sd() #Standard deviation
```

##Uncategorized
```{r}
count()
tally()
is.na(data) #Logically evaluates each value. Returns T if value == NA, F if value has a value.
```

##Useful Links
- [ggplot2 cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
- [`ggplot` themes](https://ggplot2.tidyverse.org/reference/ggtheme.html)

